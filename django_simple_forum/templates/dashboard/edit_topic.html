{% extends 'dashboard/dashboard_base.html' %}
{% block stage %}
<div class="content">
	<div class="new topic">
	 <div class="new-header">
	    <label>Edit Topic</label>
	  </div>
	  <div class="update-topic">
        <form class="form-horizontal" name="newtopicform" id="newtopicform" method="post">
            <div class="form-group">
              <label for="exampleInputEmail1">Please enter your question </label>
              <input type="text" class="form-control" placeholder="What is this discussion about in one brief sentence?" name="title" id="title" value="{{ topic.title }}">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Select Category</label>
              <select class=" select2" name="category" id="category">
                  <option value="">Select A Category</option>
                  {% for category in categories %}
                    <option value='{{ category.id }}' {% if topic.category.parent %}{% if topic.category.parent.id == category.id %}selected{% endif %}{% else %}{% if topic.category.id == category.id %}selected{% endif %}{% endif %}>{{ category.title }}</option>
                  {% endfor %}
                </select>
            </div>
            <div class="form-group sub_category">
              <label for="exampleInputPassword1">Select Sub Category</label>
              <select class="form-control" name="sub_category" id="sub_category">
                  <option value="">Select A Category</option>
                  {% for category in sub_categories %}
                    <option value='{{ category.id }}' class='{{ category.parent.id }}' {% if topic.category.id == category.id %}selected{% endif %} >{{ category.title }}</option>
                  {% endfor %}
                </select>
            </div>
            <div class="form-group">
              <label for="exampleInputEmail1">Add Description</label>
               <textarea class="form-control" name='textareacontents' id="textareacontents">{{ topic.description }}</textarea>
               <input type="hidden" name="description" id="description" value="{{ topic.description }}" >
            </div>
            <div class="form-group">
              <label for="exampleInputEmail1">Choose optional tags for this topic</label>
               <input id="tags" type="text" class="tags form-control" value="" name="tags"/>
            </div>
            <div class="form-group">
		        <div class="col-sm-12 save_buttons">
		          <button type="submit" class="btn btn-default submit">Submit Your Question</button>
		          <button type="button" class="btn btn-default cancel">Cancel</button>
		        </div>
		    </div>
        </form>
	  </div>
	</div>
</div>
{% endblock %}
{% block extra_js %}
<script type="text/javascript">
  $sub_category = $('[name="sub_category"]')
  {% if topic and topic.category and topic.category.parent %}
    var val = '{{ topic.category.parent.id }}'
    $sub_category.find('option').hide();
    $sub_category.find('option.'+val).show();
  {% elif topic and topic.category and not topic.category.parent %}
    var val = '{{ topic.category.id }}'
    $sub_category.find('option').hide();
    $sub_category.find('option.'+val).show();
  {% else %}
    $sub_category.find('option').hide();
  {% endif %}
  $('[name="category"]').change(function (e) {
    var val = $("option:selected", this).val()
    $sub_category = $('[name="sub_category"]')
    $sub_category.val('');
    $sub_category.find('option').hide();
    $sub_category.find('option.'+val).show();
  });
  CKEDITOR.replace( 'textareacontents',
   {
   // toolbar :
   // [
   // { name: 'basicstyles', items : [ 'Bold','Italic' ] },
   // { name: 'paragraph', items : [ 'NumberedList','BulletedList','-','Outdent','Indent','-','Blockquote','CreateDiv',
   // '-','JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock','-','BidiLtr','BidiRtl' ] },
   // ],
   // skin : 'office2003',
   uiColor: '#ffffff',
     height:260,
   //width: 700,
   });
	$('form#newtopicform').submit(function(e){
        e.preventDefault();
        $("input[name='description']").val(CKEDITOR.instances.textareacontents.getData());
        $.post('.', $('form#newtopicform').serialize(), function(data){
          if(data.error){

            $('div.error').remove();
            for (var key in data.response) {
              console.log(key)
              $('#newtopicform #' + key).after('<div class="error">' + data.response[key] + '</div>');
            }
          }
          else{
              alert('Topic has been Updated Successfully.')
            window.location = "{% url 'django_simple_forum:topics' %}";
          }
        }, 'json');
    });
$('.cancel').click(function(e){
	window.location = "{% url 'django_simple_forum:topics' %}";
});
</script>
{% endblock %}